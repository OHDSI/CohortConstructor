<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Build and Manipulate Study Cohorts Using a Common Data Model • CohortConstructor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Build and Manipulate Study Cohorts Using a Common Data Model">
<meta name="description" content="Create and manipulate study cohorts in data mapped to the Observational Medical Outcomes Partnership Common Data Model.">
<meta property="og:description" content="Create and manipulate study cohorts in data mapped to the Observational Medical Outcomes Partnership Common Data Model.">
<meta property="og:image" content="https://ohdsi.github.io/CohortConstructor/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">CohortConstructor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/a00_introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="articles/a01_building_base_cohorts.html">Building base cohorts</a></li>
    <li><a class="dropdown-item" href="articles/a02_cohort_table_requirements.html">Applying cohort table requirements</a></li>
    <li><a class="dropdown-item" href="articles/a03_require_demographics.html">Applying demographic requirements to a cohort</a></li>
    <li><a class="dropdown-item" href="articles/a04_require_intersections.html">Applying requirements related to other cohorts, concept sets, or tables</a></li>
    <li><a class="dropdown-item" href="articles/a05_update_cohort_start_end.html">Updating cohort start and end dates</a></li>
    <li><a class="dropdown-item" href="articles/a06_concatanate_cohorts.html">Concatenating cohort records</a></li>
    <li><a class="dropdown-item" href="articles/a07_filter_cohorts.html">Filtering cohorts</a></li>
    <li><a class="dropdown-item" href="articles/a08_split_cohorts.html">Splitting cohorts</a></li>
    <li><a class="dropdown-item" href="articles/a09_combine_cohorts.html">Combining Cohorts</a></li>
    <li><a class="dropdown-item" href="articles/a10_match_cohorts.html">Generating a matched cohort</a></li>
    <li><a class="dropdown-item" href="articles/a11_benchmark.html">CohortConstructor benchmarking results</a></li>
    <li><a class="dropdown-item" href="articles/a12_behind_the_scenes.html">Behind the scenes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/CohortConstructor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="cohortconstructor-">CohortConstructor <a class="anchor" aria-label="anchor" href="#cohortconstructor-"></a>
</h1>
</div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of CohortConstructor is to support the creation and manipulation of study cohorts in data mapped to the OMOP CDM.</p>
<div class="section level2">
<h2 id="tested-sources">Tested sources<a class="anchor" aria-label="anchor" href="#tested-sources"></a>
</h2>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Source</th>
<th>Driver</th>
<th>CDM reference</th>
<th>Status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Local R dataframe</td>
<td>N/A</td>
<td><code><a href="https://darwin-eu.github.io/omopgenerics/reference/cdmFromTables.html" class="external-link">omopgenerics::cdmFromTables()</a></code></td>
<td><a href="https://github.com/OHDSI/CohortConstructor/actions/workflows/test-local-omopgenerics.yaml" class="external-link"><img src="https://github.com/OHDSI/CohortConstructor/actions/workflows/test-local-omopgenerics.yaml/badge.svg?branch=main"></a></td>
</tr>
<tr class="even">
<td>In-memory duckdb datatabase</td>
<td>duckdb</td>
<td><code><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">CDMConnector::cdmFromCon()</a></code></td>
<td><a href="https://github.com/OHDSI/CohortConstructor/actions/workflows/test-duckdb-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/CohortConstructor/actions/workflows/test-duckdb-CDMConnector.yaml/badge.svg?branch=main"></a></td>
</tr>
<tr class="odd">
<td>Postgres database</td>
<td>RPostgres</td>
<td><code><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">CDMConnector::cdmFromCon()</a></code></td>
<td></td>
</tr>
<tr class="even">
<td>Postgres database</td>
<td>DatabaseConnector</td>
<td><code><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">CDMConnector::cdmFromCon()</a></code></td>
<td></td>
</tr>
<tr class="odd">
<td>SQL Server database</td>
<td>odbc</td>
<td><code><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">CDMConnector::cdmFromCon()</a></code></td>
<td></td>
</tr>
<tr class="even">
<td>SQL Server database</td>
<td>DatabaseConnector</td>
<td><code><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">CDMConnector::cdmFromCon()</a></code></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package can be installed from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"CohortConstructor"</span><span class="op">)</span></span></code></pre></div>
<p>Or you can install the development version of the package from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ohdsi/CohortConstructor"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-and-manipulating-cohorts">Creating and manipulating cohorts<a class="anchor" aria-label="anchor" href="#creating-and-manipulating-cohorts"></a>
</h2>
<p>To illustrate the functionality provided by CohortConstructor let’s create a cohort of people with a fracture using the Eunomia dataset. We’ll first load required packages and create a cdm reference for the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/omopgenerics/" class="external-link">omopgenerics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/omock/" class="external-link">omock</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/PatientProfiles/" class="external-link">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortConstructor/">CohortConstructor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CohortCharacteristics/" class="external-link">CohortCharacteristics</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/omock/reference/mockCdmFromDataset.html" class="external-link">mockCdmFromDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span>, source <span class="op">=</span> <span class="st">"duckdb"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Reading GiBleed tables.</span></span>
<span><span class="co">#&gt; ℹ Adding drug_strength table.</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── # OMOP CDM reference (duckdb) of GiBleed ────────────────────────────────────</span></span>
<span><span class="co">#&gt; • omop tables: care_site, cdm_source, concept, concept_ancestor, concept_class,</span></span>
<span><span class="co">#&gt; concept_relationship, concept_synonym, condition_era, condition_occurrence,</span></span>
<span><span class="co">#&gt; cost, death, device_exposure, domain, dose_era, drug_era, drug_exposure,</span></span>
<span><span class="co">#&gt; drug_strength, fact_relationship, location, measurement, metadata, note,</span></span>
<span><span class="co">#&gt; note_nlp, observation, observation_period, payer_plan_period, person,</span></span>
<span><span class="co">#&gt; procedure_occurrence, provider, relationship, source_to_concept_map, specimen,</span></span>
<span><span class="co">#&gt; visit_detail, visit_occurrence, vocabulary</span></span>
<span><span class="co">#&gt; • cohort tables: -</span></span>
<span><span class="co">#&gt; • achilles tables: -</span></span>
<span><span class="co">#&gt; • other tables: -</span></span></code></pre></div>
<div class="section level3">
<h3 id="generating-concept-based-fracture-cohorts">Generating concept-based fracture cohorts<a class="anchor" aria-label="anchor" href="#generating-concept-based-fracture-cohorts"></a>
</h3>
<p>We will first need to identify codes that could be used to represent fractures of interest. To find these we’ll use the CodelistGenerator package (note, we will just find a few codes because we are using synthetic data with a subset of the full vocabularies).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">hip_fx_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getCandidateCodes.html" class="external-link">getCandidateCodes</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="st">"hip fracture"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Limiting to domains of interest</span></span>
<span><span class="co">#&gt; Getting concepts to include</span></span>
<span><span class="co">#&gt; Adding descendants</span></span>
<span><span class="co">#&gt; Search completed. Finishing up.</span></span>
<span><span class="co">#&gt; ✔ 1 candidate concept identified</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0 minutes and 0 seconds</span></span>
<span><span class="va">forearm_fx_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getCandidateCodes.html" class="external-link">getCandidateCodes</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="st">"forearm fracture"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Limiting to domains of interest</span></span>
<span><span class="co">#&gt; Getting concepts to include</span></span>
<span><span class="co">#&gt; Adding descendants</span></span>
<span><span class="co">#&gt; Search completed. Finishing up.</span></span>
<span><span class="co">#&gt; ✔ 1 candidate concept identified</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0 minutes and 0 seconds</span></span>
<span></span>
<span><span class="va">fx_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/newCodelist.html" class="external-link">newCodelist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hip_fracture"</span> <span class="op">=</span> <span class="va">hip_fx_codes</span><span class="op">$</span><span class="va">concept_id</span>,</span>
<span>                             <span class="st">"forearm_fracture"</span><span class="op">=</span> <span class="va">forearm_fx_codes</span><span class="op">$</span><span class="va">concept_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fx_codes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── 2 codelists ─────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - forearm_fracture (1 codes)</span></span>
<span><span class="co">#&gt; - hip_fracture (1 codes)</span></span></code></pre></div>
<p>Now we can quickly create our cohorts. For this we only need to provide the codes we have defined and we will get a cohort back, where we start by setting cohort exit as the same day as event start (the date of the fracture).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="va">cdm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/conceptCohort.html">conceptCohort</a></span><span class="op">(</span>conceptSet <span class="op">=</span> <span class="va">fx_codes</span>, </span>
<span>                exit <span class="op">=</span> <span class="st">"event_start_date"</span>, </span>
<span>                name <span class="op">=</span> <span class="st">"fractures"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::mutate()`.</span></span>
<span><span class="co">#&gt; ℹ In argument: `vocabulary_version = CodelistGenerator::getVocabVersion(cdm)`.</span></span>
<span><span class="co">#&gt; Caused by warning:</span></span>
<span><span class="co">#&gt; ! The `cdm` argument of `vocabularyVersion()` is deprecated as of</span></span>
<span><span class="co">#&gt;   CodelistGenerator 4.0.0.</span></span>
<span><span class="co">#&gt; ℹ The deprecated feature was likely used in the CohortConstructor package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span></code></pre></div>
<p>After creating our initial cohort we will update it so that exit is set at up to 180 days after start (so long as individuals’ observation end date is on or after this - if not, exit will be at observation period end).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/padCohortEnd.html">padCohortEnd</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">180</span><span class="op">)</span></span></code></pre></div>
<p>We can see that our starting cohorts, before we add any additional restrictions, have the following associated settings, counts, and attrition.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2</span></span>
<span><span class="co">#&gt; $ cohort_name          &lt;chr&gt; "forearm_fracture", "hip_fracture"</span></span>
<span><span class="co">#&gt; $ cdm_version          &lt;chr&gt; "5.3", "5.3"</span></span>
<span><span class="co">#&gt; $ vocabulary_version   &lt;chr&gt; "v5.0 18-JAN-19", "v5.0 18-JAN-19"</span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 569, 138</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 510, 132</span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 14</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 569, 569, 569, 569, 569, 569, 569, 138, 138, 138,…</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 510, 510, 510, 510, 510, 510, 510, 132, 132, 132,…</span></span>
<span><span class="co">#&gt; $ reason_id            &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7</span></span>
<span><span class="co">#&gt; $ reason               &lt;chr&gt; "Initial qualifying events", "Record in observati…</span></span>
<span><span class="co">#&gt; $ excluded_records     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0</span></span>
<span><span class="co">#&gt; $ excluded_subjects    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-an-overall-fracture-cohort">Create an overall fracture cohort<a class="anchor" aria-label="anchor" href="#create-an-overall-fracture-cohort"></a>
</h3>
<p>So far we have created three separate fracture cohorts. Let’s say we also want a cohort of people with any of the fractures. We could union our three cohorts to create this overall cohort like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/unionCohorts.html">unionCohorts</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span>,</span>
<span>                              cohortName <span class="op">=</span> <span class="st">"any_fracture"</span>, </span>
<span>                              keepOriginalCohorts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              name <span class="op">=</span><span class="st">"fractures"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name      cdm_version vocabulary_version   gap</span></span>
<span><span class="co">#&gt;                  &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1                    1 forearm_fracture 5.3         v5.0 18-JAN-19        NA</span></span>
<span><span class="co">#&gt; 2                    2 hip_fracture     5.3         v5.0 18-JAN-19        NA</span></span>
<span><span class="co">#&gt; 3                    3 any_fracture     &lt;NA&gt;        &lt;NA&gt;                   0</span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1                    1            569             510</span></span>
<span><span class="co">#&gt; 2                    2            138             132</span></span>
<span><span class="co">#&gt; 3                    3            707             611</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="require-in-date-range">Require in date range<a class="anchor" aria-label="anchor" href="#require-in-date-range"></a>
</h3>
<p>Once we have created our base fracture cohort, we can then start applying additional cohort requirements. For example, first we can require that individuals’ cohort start date fall within a certain date range.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/requireInDateRange.html">requireInDateRange</a></span><span class="op">(</span>dateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2020-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now that we’ve applied this date restriction, we can see that our cohort attributes have been updated</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2, 3</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 152, 62, 214</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 143, 60, 196</span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op">==</span> <span class="st">"cohort_start_date between 2000-01-01 &amp; 2020-01-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 0</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; </span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; </span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; </span></span>
<span><span class="co">#&gt; $ reason_id            &lt;int&gt; </span></span>
<span><span class="co">#&gt; $ reason               &lt;chr&gt; </span></span>
<span><span class="co">#&gt; $ excluded_records     &lt;int&gt; </span></span>
<span><span class="co">#&gt; $ excluded_subjects    &lt;int&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="applying-demographic-requirements">Applying demographic requirements<a class="anchor" aria-label="anchor" href="#applying-demographic-requirements"></a>
</h3>
<p>We can also add restrictions on patient characteristics such as age (on cohort start date by default) and sex.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/requireDemographics.html">requireDemographics</a></span><span class="op">(</span>ageRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">65</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      sex <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span></span></code></pre></div>
<p>Again we can see how many individuals we’ve lost after applying these criteria.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op">==</span> <span class="st">"Age requirement: 40 to 65"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2, 3</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 64, 22, 86</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 62, 22, 83</span></span>
<span><span class="co">#&gt; $ reason_id            &lt;int&gt; 10, 10, 4</span></span>
<span><span class="co">#&gt; $ reason               &lt;chr&gt; "Age requirement: 40 to 65", "Age requirement: 40…</span></span>
<span><span class="co">#&gt; $ excluded_records     &lt;int&gt; 88, 40, 128</span></span>
<span><span class="co">#&gt; $ excluded_subjects    &lt;int&gt; 81, 38, 113</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op">==</span> <span class="st">"Sex requirement: Female"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2, 3</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 37, 12, 49</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 36, 12, 48</span></span>
<span><span class="co">#&gt; $ reason_id            &lt;int&gt; 11, 11, 5</span></span>
<span><span class="co">#&gt; $ reason               &lt;chr&gt; "Sex requirement: Female", "Sex requirement: Fema…</span></span>
<span><span class="co">#&gt; $ excluded_records     &lt;int&gt; 27, 10, 37</span></span>
<span><span class="co">#&gt; $ excluded_subjects    &lt;int&gt; 26, 10, 35</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="require-presence-in-another-cohort">Require presence in another cohort<a class="anchor" aria-label="anchor" href="#require-presence-in-another-cohort"></a>
</h3>
<p>We can also require that individuals are (or are not) in another cohort over some window. Here for example we require that study participants are in a GI bleed cohort any time prior up to their entry in the fractures cohort.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">gibleed</span> <span class="op">&lt;-</span> <span class="va">cdm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/conceptCohort.html">conceptCohort</a></span><span class="op">(</span>conceptSet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"gibleed"</span> <span class="op">=</span> <span class="fl">192671L</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"gibleed"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/requireCohortIntersect.html">requireCohortIntersect</a></span><span class="op">(</span>targetCohortTable <span class="op">=</span> <span class="st">"gibleed"</span>,</span>
<span>                         intersections <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">fractures</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op">==</span> <span class="st">"Not in cohort gibleed between -Inf &amp; 0 days relative to cohort_start_date"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2, 3</span></span>
<span><span class="co">#&gt; $ number_records       &lt;int&gt; 30, 10, 40</span></span>
<span><span class="co">#&gt; $ number_subjects      &lt;int&gt; 30, 10, 40</span></span>
<span><span class="co">#&gt; $ reason_id            &lt;int&gt; 14, 14, 8</span></span>
<span><span class="co">#&gt; $ reason               &lt;chr&gt; "Not in cohort gibleed between -Inf &amp; 0 days rela…</span></span>
<span><span class="co">#&gt; $ excluded_records     &lt;int&gt; 7, 2, 9</span></span>
<span><span class="co">#&gt; $ excluded_subjects    &lt;int&gt; 6, 2, 8</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cdmDisconnect.html" class="external-link">cdmDisconnect</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="more-information">More information<a class="anchor" aria-label="anchor" href="#more-information"></a>
</h3>
<p>CohortConstructor provides much more functionality for creating and manipulating cohorts. See the package vignettes for more details.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=CohortConstructor" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/OHDSI/CohortConstructor/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing CohortConstructor</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Edward Burn <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9286-1128" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Martí Català <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-3308-9905" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Nuria Mercade-Besora <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0006-7948-3747" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Marta Alcalde-Herraiz <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0002-4405-1814" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Mike Du <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9517-8834" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Yuchen Guo <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-0847-4855" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Xihang Chen <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0001-8112-8959" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Kim Lopez-Guell <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-8462-8668" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Elin Rowlands <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0005-5166-0417" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=CohortConstructor" class="external-link"><img src="https://www.r-pkg.org/badges/version/CohortConstructor" alt="CRAN status"></a></li>
<li><a href="https://github.com/OHDSI/CohortConstructor/actions" class="external-link"><img src="https://github.com/OHDSI/CohortConstructor/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/OHDSI/CohortConstructor?branch=main" class="external-link"><img src="https://codecov.io/gh/OHDSI/CohortConstructor/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/Lifecycle-Experimental-339999" alt="Lifecycle:Experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Burn, Martí Català, Nuria Mercade-Besora, Marta Alcalde-Herraiz, Mike Du, Yuchen Guo, Xihang Chen, Kim Lopez-Guell, Elin Rowlands.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
