<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Updating cohort start and end dates • CohortConstructor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Updating cohort start and end dates">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortConstructor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a00_introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/a01_building_base_cohorts.html">Building base cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a02_cohort_table_requirements.html">Applying cohort table requirements</a></li>
    <li><a class="dropdown-item" href="../articles/a03_require_demographics.html">Applying demographic requirements to a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a04_require_intersections.html">Applying requirements related to other cohorts, concept sets, or tables</a></li>
    <li><a class="dropdown-item" href="../articles/a05_update_cohort_start_end.html">Updating cohort start and end dates</a></li>
    <li><a class="dropdown-item" href="../articles/a06_concatanate_cohorts.html">Concatenating cohort records</a></li>
    <li><a class="dropdown-item" href="../articles/a07_filter_cohorts.html">Filtering cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a08_split_cohorts.html">Splitting cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a09_combine_cohorts.html">Combining Cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a10_match_cohorts.html">Generating a matched cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a11_benchmark.html">CohortConstructor benchmarking results</a></li>
    <li><a class="dropdown-item" href="../articles/a12_behind_the_scenes.html">Behind the scenes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/CohortConstructor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Updating cohort start and end dates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortConstructor/blob/main/vignettes/a05_update_cohort_start_end.Rmd" class="external-link"><code>vignettes/a05_update_cohort_start_end.Rmd</code></a></small>
      <div class="d-none name"><code>a05_update_cohort_start_end.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Accurately defining cohort entry and exit dates is crucial in
observational research to ensure the validity of study findings. The
<code>CohortConstructor</code> package provides several functions to
adjust these dates based on specific criteria, and this vignette
demonstrates how to use them.</p>
<p>Functions to update cohort dates can be categorized into four
groups:</p>
<ul>
<li><p><strong>Exit at Specific Date Functions:</strong> Adjust the
cohort end date to predefined events (observation end and death
date).</p></li>
<li><p><strong>Cohort Entry or Exit Based on Other Date
Columns:</strong> Modify cohort start or end dates to the earliest or
latests from a set of date columns.</p></li>
<li><p><strong>Trim Dates Functions:</strong> Restrict cohort entries
based on demographic criteria or specific date ranges.</p></li>
<li><p><strong>Pad Dates Functions:</strong> Adjust cohort start or end
dates by adding or subtracting a specified number of days.</p></li>
</ul>
<p>We’ll explore each category in the following sections.</p>
<p>First, we’ll connect to the Eunomia synthetic data and create a mock
cohort of women in the database to use as example in the vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortConstructor/">CohortConstructor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CohortCharacteristics/" class="external-link">CohortCharacteristics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/PatientProfiles/" class="external-link">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/omock/" class="external-link">omock</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://clock.r-lib.org" class="external-link">clock</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/omock/reference/mockCdmFromDataset.html" class="external-link">mockCdmFromDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span>, source <span class="op">=</span> <span class="st">"duckdb"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Reading <span style="color: #0000BB;">GiBleed</span> tables.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Adding <span style="color: #0000BB;">drug_strength</span> table.</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/demographicsCohort.html">demographicsCohort</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"cohort"</span>, sex <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Building new trimmed cohort</span></span>
<span><span class="co">#&gt; Adding demographics information</span></span>
<span><span class="co">#&gt; Creating initial cohort</span></span>
<span><span class="co">#&gt; Trim sex</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Cohort trimmed</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exit-at-specific-date">Exit at Specific Date<a class="anchor" aria-label="anchor" href="#exit-at-specific-date"></a>
</h2>
<div class="section level3">
<h3 id="exitatobservationend">
<code>exitAtObservationEnd()</code><a class="anchor" aria-label="anchor" href="#exitatobservationend"></a>
</h3>
<p>The <code><a href="../reference/exitAtObservationEnd.html">exitAtObservationEnd()</a></code> function updates the cohort
end date to the end of the observation period for each subject. This
ensures that the cohort exit does not extend beyond the period during
which data is available for the subject.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_observation_end</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exitAtObservationEnd.html">exitAtObservationEnd</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"cohort_observation_end"</span><span class="op">)</span></span></code></pre></div>
<p>As cohort entries cannot overlap, updating the end date to the
observation end may result in overlapping records. In such cases,
overlapping records are collapsed into a single entry (starting at the
earliest entry and ending at the end of observation).</p>
<p>This function has an argument
<code>persistAcrossObservationPeriods</code> to consider cases when a
subject may have more than one observation period. If
<code>persistAcrossObservationPeriods = FALSE</code> then cohort end
date will be set to the end of the observation period where the record
occurs. If <code>persistAcrossObservationPeriods = TRUE</code>, in
addition to updating the cohort end to the current observation end,
cohort entries are created for each of the subsequent observation
periods.</p>
</div>
<div class="section level3">
<h3 id="exitatdeath">
<code>exitAtDeath()</code><a class="anchor" aria-label="anchor" href="#exitatdeath"></a>
</h3>
<p>The <code><a href="../reference/exitAtDeath.html">exitAtDeath()</a></code> function sets the cohort end date to
the recorded death date of the subject.</p>
<p>By default, it keeps the end date of subjects who do not have a death
record unmodified; however, these can be dropped with the argument
<code>requireDeath.</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_death</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exitAtDeath.html">exitAtDeath</a></span><span class="op">(</span>requireDeath <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"cohort_death"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cohort-entry-or-exit-based-on-other-date-columns">Cohort Entry or Exit Based on Other Date Columns<a class="anchor" aria-label="anchor" href="#cohort-entry-or-exit-based-on-other-date-columns"></a>
</h2>
<div class="section level3">
<h3 id="entryatfirstdate">
<code>entryAtFirstDate()</code><a class="anchor" aria-label="anchor" href="#entryatfirstdate"></a>
</h3>
<p>The <code><a href="../reference/entryAtFirstDate.html">entryAtFirstDate()</a></code> function updates the cohort start
date to the earliest date among specified columns.</p>
<p>Next we want to set the entry date to the first of: diclofenac or
acetaminophen prescriptions after cohort start, or cohort end date.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create cohort with of drugs diclofenac and acetaminophen </span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">medications</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conceptCohort.html">conceptCohort</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"medications"</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"diclofenac"</span> <span class="op">=</span> <span class="fl">1124300</span>, <span class="st">"acetaminophen"</span> <span class="op">=</span> <span class="fl">1127433</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> `codelist` casted to integers.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Subsetting table <span style="font-weight: bold;">drug_exposure</span> using 2 concepts with domain: <span style="font-weight: bold;">drug</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Combining tables.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Creating cohort attributes.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Applying cohort requirements.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Merging overlapping records.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Cohort <span style="font-weight: bold;">medications</span> created.</span></span>
<span></span>
<span><span class="co"># add date first ocurrence of these drugs from index date</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_dates</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://darwin-eu.github.io/PatientProfiles/reference/addCohortIntersectDate.html" class="external-link">addCohortIntersectDate</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"medications"</span>, </span>
<span>    nameStyle <span class="op">=</span> <span class="st">"{cohort_name}"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"cohort_dates"</span></span>
<span>    <span class="op">)</span> </span>
<span></span>
<span><span class="co"># set cohort start at the first ocurrence of one of the drugs, or the end date</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_entry_first</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort_dates</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/entryAtFirstDate.html">entryAtFirstDate</a></span><span class="op">(</span></span>
<span>    dateColumns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diclofenac"</span>, <span class="st">"acetaminophen"</span>, <span class="st">"cohort_end_date"</span><span class="op">)</span>, </span>
<span>    name <span class="op">=</span> <span class="st">"cohort_entry_first"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(cohort_definition_id, subject_id, cohort_end_date)`</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_entry_first</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;results.test_cohort_entry_first&gt; [?? x 6]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 1.4.1 [unknown@Linux 6.14.0-1012-azure:R 4.5.1//tmp/RtmpIxJFHb/file285d58198c19.duckdb]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date diclofenac</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1       <span style="text-decoration: underline;">3</span>376 1961-11-11        2019-06-28      1994-05-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1       <span style="text-decoration: underline;">2</span>507 1979-08-27        2019-04-17      <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1       <span style="text-decoration: underline;">1</span>882 1985-11-27        2018-10-20      <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1       <span style="text-decoration: underline;">5</span>132 1970-05-21        2019-06-06      2003-06-15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        390 1989-10-20        2019-06-05      2016-05-15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1       <span style="text-decoration: underline;">1</span>137 1956-11-18        2013-10-26      <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1       <span style="text-decoration: underline;">3</span>314 1986-08-05        2019-01-26      <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1       <span style="text-decoration: underline;">1</span>475 1961-01-03        2019-01-17      <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1       <span style="text-decoration: underline;">4</span>476 1962-04-21        2019-05-19      2000-02-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1       <span style="text-decoration: underline;">2</span>409 1993-11-12        2019-06-15      2018-10-06</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: acetaminophen &lt;date&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="entryatlastdate">
<code>entryAtLastDate()</code><a class="anchor" aria-label="anchor" href="#entryatlastdate"></a>
</h3>
<p>The <code><a href="../reference/entryAtLastDate.html">entryAtLastDate()</a></code> function works similarly to
<code><a href="../reference/entryAtFirstDate.html">entryAtFirstDate()</a></code>, however now the selected column is the
latest date among specified columns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_entry_last</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort_dates</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/entryAtLastDate.html">entryAtLastDate</a></span><span class="op">(</span></span>
<span>    dateColumns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diclofenac"</span>, <span class="st">"acetaminophen"</span>, <span class="st">"cohort_end_date"</span><span class="op">)</span>, </span>
<span>    keepDateColumns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"cohort_entry_last"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_entry_last</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;results.test_cohort_entry_last&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 1.4.1 [unknown@Linux 6.14.0-1012-azure:R 4.5.1//tmp/RtmpIxJFHb/file285d58198c19.duckdb]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         12 2019-03-06        2019-03-06     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         19 2018-08-19        2018-08-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         36 2019-01-15        2019-01-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1        404 2019-03-26        2019-03-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        905 2019-04-26        2019-04-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1        987 2019-06-02        2019-06-02     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1       <span style="text-decoration: underline;">1</span>000 2019-03-19        2019-03-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1       <span style="text-decoration: underline;">1</span>113 2017-12-05        2017-12-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1       <span style="text-decoration: underline;">1</span>118 2019-06-23        2019-06-23     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1       <span style="text-decoration: underline;">1</span>335 2018-11-26        2018-11-26     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>In this example, we set <code>keepDateColumns</code> to FALSE, which
drops columns in <code>dateColumns</code>.</p>
</div>
<div class="section level3">
<h3 id="exitatfirstdate">
<code>exitAtFirstDate()</code><a class="anchor" aria-label="anchor" href="#exitatfirstdate"></a>
</h3>
<p>The <code><a href="../reference/exitAtFirstDate.html">exitAtFirstDate()</a></code> function updates the cohort end
date to the earliest date among specified columns.</p>
<p>For instance, next we want the exit to be observation end, except if
there is a record of diclofenac or acetaminophen, in which case that
would be the end:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_exit_first</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort_dates</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://darwin-eu.github.io/PatientProfiles/reference/addFutureObservation.html" class="external-link">addFutureObservation</a></span><span class="op">(</span>futureObservationType <span class="op">=</span> <span class="st">"date"</span>, name <span class="op">=</span> <span class="st">"cohort_exit_first"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/exitAtFirstDate.html">exitAtFirstDate</a></span><span class="op">(</span></span>
<span>    dateColumns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"future_observation"</span>, <span class="st">"acetaminophen"</span>, <span class="st">"diclofenac"</span><span class="op">)</span>,</span>
<span>    keepDateColumns <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_exit_first</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;results.test_cohort_exit_first&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 1.4.1 [unknown@Linux 6.14.0-1012-azure:R 4.5.1//tmp/RtmpIxJFHb/file285d58198c19.duckdb]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         16 1971-10-14        1985-03-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1        165 1968-06-12        1991-02-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1        280 1938-10-28        1975-01-07     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1        351 1977-11-29        1982-10-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        715 1983-02-15        1992-11-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1       <span style="text-decoration: underline;">1</span>102 1967-01-24        1970-10-06     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1       <span style="text-decoration: underline;">1</span>352 1946-08-04        1946-09-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1       <span style="text-decoration: underline;">1</span>442 1946-02-05        1955-01-21     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1       <span style="text-decoration: underline;">1</span>524 1967-01-12        1988-02-23     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1       <span style="text-decoration: underline;">1</span>960 1930-07-08        2010-04-13     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exitatlastdate">
<code>exitAtLastDate()</code><a class="anchor" aria-label="anchor" href="#exitatlastdate"></a>
</h3>
<p>Similarly, the <code><a href="../reference/exitAtLastDate.html">exitAtLastDate()</a></code> function sets the cohort
end date to the latest date among specified columns.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_exit_last</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort_dates</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exitAtLastDate.html">exitAtLastDate</a></span><span class="op">(</span></span>
<span>    dateColumns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cohort_end_date"</span>, <span class="st">"acetaminophen"</span>, <span class="st">"diclofenac"</span><span class="op">)</span>,</span>
<span>    returnReason <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    keepDateColumns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"cohort_exit_last"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_exit_last</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;results.test_cohort_exit_last&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 1.4.1 [unknown@Linux 6.14.0-1012-azure:R 4.5.1//tmp/RtmpIxJFHb/file285d58198c19.duckdb]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         19 1949-01-30        2018-08-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         36 1958-10-21        2019-01-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1        190 1930-07-08        2016-04-12     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1        276 1977-06-10        2018-10-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        387 1973-08-31        2017-09-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1        525 1949-04-04        2018-07-23     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1        763 1965-03-18        2019-04-11     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1        905 1968-09-21        2019-04-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1       <span style="text-decoration: underline;">1</span>098 1955-12-10        2019-02-23     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1       <span style="text-decoration: underline;">1</span>118 1973-08-12        2019-06-23     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>In this last example, the return cohort doesn’t have the specified
date columns, neither the “reason” column indicating which date was used
for entry/exit. These was set with the <code>keepDateColumns</code> and
<code>returnReason</code> arguments, common throughout the functions in
this category.</p>
</div>
</div>
<div class="section level2">
<h2 id="trim-dates-functions">Trim Dates Functions<a class="anchor" aria-label="anchor" href="#trim-dates-functions"></a>
</h2>
<div class="section level3">
<h3 id="trimdemographics">
<code>trimDemographics()</code><a class="anchor" aria-label="anchor" href="#trimdemographics"></a>
</h3>
<p>The <code><a href="../reference/trimDemographics.html">trimDemographics()</a></code> function restricts the cohort
based on patient demographics. This means that cohort start and end
dates are moved (within the original cohort entry dates) to ensure that
individuals meet specific demographic criteria throughout their cohort
participation. If individuals do not satisfy the criteria at any point
during their cohort period, their records are excluded.</p>
<p>For instance, if we trim using an age range from 18 to 65,
individuals will only contribute in the cohort form the day they are 18
or older, up to the day before turning 66 (or before if they leave the
database).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_trim</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/trimDemographics.html">trimDemographics</a></span><span class="op">(</span>ageRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">65</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"cohort_trim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Building new trimmed cohort</span></span>
<span><span class="co">#&gt; Adding demographics information</span></span>
<span><span class="co">#&gt; Creating initial cohort</span></span>
<span><span class="co">#&gt; Trim age</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Cohort trimmed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trimtodaterange">
<code>trimToDateRange()</code><a class="anchor" aria-label="anchor" href="#trimtodaterange"></a>
</h3>
<p>The <code><a href="../reference/trimToDateRange.html">trimToDateRange()</a></code> function confines cohort entry and
exit dates within a specified date range, ensuring that cohort periods
align with the defined timeframe. If only the start or end of a range is
required, the other can be set to <code>NA</code>.</p>
<p>For example, to restrict cohort dates to be on or after January 1st,
2015:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trim cohort dates to be within the year 2000</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_trim</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort_trim</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/trimToDateRange.html">trimToDateRange</a></span><span class="op">(</span>dateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2015-01-01"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="pad-dates-functions">Pad Dates Functions<a class="anchor" aria-label="anchor" href="#pad-dates-functions"></a>
</h2>
<div class="section level3">
<h3 id="padcohortstart">
<code>padCohortStart()</code><a class="anchor" aria-label="anchor" href="#padcohortstart"></a>
</h3>
<p>The <code><a href="../reference/padCohortStart.html">padCohortStart()</a></code> function adds (or subtracts) a
specified number of days to the cohort start date.</p>
<p>For example, to subtract 50 days from the cohort start date:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Substract 50 days to cohort start</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/padCohortStart.html">padCohortStart</a></span><span class="op">(</span>days <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, collapse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>When subtracting days, it may result in cohort start dates preceding
the observation period start. By default, such entries are corrected to
the observation period start. To drop these entries instead, set the
<code>requireFullContribution</code> argument to TRUE</p>
<p>Additionally, adjusting cohort start dates may lead to overlapping
entries for the same subject. The <code>collapse</code> argument manages
this: if TRUE, merges overlapping entries into a single record with the
earliest start and latest end date (default), if FALSE retains only the
first of the overlapping entries.</p>
</div>
<div class="section level3">
<h3 id="padcohortend">
<code>padCohortEnd()</code><a class="anchor" aria-label="anchor" href="#padcohortend"></a>
</h3>
<p>Similarly, the <code><a href="../reference/padCohortEnd.html">padCohortEnd()</a></code> function adjusts the
cohort end date by adding (or subtracting) a specified number of
days.</p>
<p>The example below adds 1000 days to cohort end date, while dropping
records that are outside of observation after adding days.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_pad</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/padCohortEnd.html">padCohortEnd</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">1000</span>, requireFullContribution <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"cohort_pad"</span><span class="op">)</span></span></code></pre></div>
<p>Additionally, days to add can also be specified with a numeric column
in the cohort, which allows to add a specific number of days for each
record:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>days_to_add <span class="op">=</span> <span class="fu"><a href="https://clock.r-lib.org/reference/date_count_between.html" class="external-link">date_count_between</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">cohort_start_date</span>, end <span class="op">=</span> <span class="va">cohort_end_date</span>, precision <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/padCohortEnd.html">padCohortEnd</a></span><span class="op">(</span>days <span class="op">=</span> <span class="st">"days_to_add"</span>, requireFullContribution <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="padcohortdate">
<code>padCohortDate()</code><a class="anchor" aria-label="anchor" href="#padcohortdate"></a>
</h3>
<p>The <code><a href="../reference/padCohortDate.html">padCohortDate()</a></code> function provides a more flexible
approach by allowing adjustments to either the cohort start or end date
based on specified parameters. You can define which date to adjust
(<code>cohortDate</code>), the reference date for the adjustment
(<code>indexDate</code>), and the number of days to add or subtract.</p>
<p>For example, to set the cohort end date to be 365 days after the
cohort start date:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/padCohortDate.html">padCohortDate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">365</span>, cohortDate <span class="op">=</span> <span class="st">"cohort_end_date"</span>, indexDate <span class="op">=</span> <span class="st">"cohort_start_date"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cohort-id-argument">Cohort ID argument<a class="anchor" aria-label="anchor" href="#cohort-id-argument"></a>
</h2>
<p>For all these functions, the cohortId argument specifies which
cohorts to modify. This allows for targeted adjustments without altering
other cohorts. For instance, to add 10 days to the end date of the
acetaminophen cohort and 20 days to the diclofenac cohort we can do the
following:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">medications</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">medications</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/padCohortDate.html">padCohortDate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">10</span>, cohortId <span class="op">=</span> <span class="st">"acetaminophen"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/padCohortDate.html">padCohortDate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">20</span>, cohortId <span class="op">=</span> <span class="st">"diclofenac"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Burn, Martí Català, Nuria Mercade-Besora, Marta Alcalde-Herraiz, Mike Du, Yuchen Guo, Xihang Chen, Kim Lopez-Guell, Elin Rowlands.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
